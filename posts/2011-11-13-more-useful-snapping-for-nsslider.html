<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="readability-verification" content="cG3MqZcEVveKZ6mnEFkePAL3Ug79Jxxp5Fn27CM7" />
<title>JS ⊢ More useful snapping for NSSlider</title>
<link rel="stylesheet" type="text/css" href="../css/screen.css" />
<link rel="stylesheet" type="text/css" href="../css/syntax.css" />
<link rel="stylesheet" type="text/css" href="../css/coqdoc.css" />
<style type="text/css">
    @import url(http://nmashton.ca/css/gloss-0.0.1.css);
</style>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="http://nmashton.ca/js/gloss-0.0.1.js"></script>
<link rel="alternate" type="application/rss+xml" title="Jonathan Sterling" href="../rss.xml" />


<!--[if IE]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<!--[if lte IE 7]>
  <script src="js/IE8.js" type="text/javascript"></script><![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" type="text/css" media="all" href="css/ie6.css"/><![endif]-->

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  'HTML-CSS': {
    availableFonts: [],
    webFont: 'TeX',
  },
  TeX: {
    Macros: {
      gk: ["\\style{font-family:Junicode!important; font-size:1.3em;}{\\text{#1}}", 1]
    }
  }
});
</script>
</head>
<body>

<header>
<h1><a href="../index.html"><span class="title">More useful snapping for NSSlider.</span></a></h1>
</header>

<section class="post">
<article><p>If you want an <code>NSSlider</code> to snap on certain intervals, your option out-of-the-box is to give it tick marks (using <code>-setNumberOfTickMarks:</code>), and then enforce that it can only be set to values coinciding with a tick mark (using <code>setAllowsTickMarkValuesOnly:</code>). This is great, if you only want to accept values at certain intervals; but it’s not very helpful if you simply want to <em>snap to</em> values at key points (like quarters, or thirds).</p>
<!--more-->

<p>I’ve seen a few solutions to this problem; <a href="http://stackoverflow.com/questions/5843699/hot-to-create-custom-nsslider-like-start-screen-saver-slider-in-system-prefer">the one that came closest</a> ended up overriding</p>
<table class="sourceCode ObjectiveC numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
</pre></td><td class="sourceCode"><pre><code class="sourceCode objectivec">-[NSSliderCell startTrackingAt:inView:],
-[NSSliderCell continueTracking:at:inView:]</code></pre></td></tr></table>
<p>and cleverly switching <code>allowsTickMarkValuesOnly</code> on and off at opportune moments. This worked visually, but the data that was streamed from the slider didn’t actually snap until after tracking ended. This is obviously a non-starter, if you’re showing continuous feedback for your slider.</p>
<h2 id="my-solution">My solution</h2>
<p>So, I’ve come up with a simpler and slightly more clever solution, which behaves just as one would expect it to.</p>
<table class="sourceCode ObjectiveC numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="sourceCode"><pre><code class="sourceCode objectivec"><span class="kw">@interface</span> JSSnappingSliderCell : NSSliderCell
<span class="kw">@end</span>

<span class="kw">@implementation</span> JSSnappingSliderCell
<span class="dt">static</span> <span class="dt">const</span> CGFloat kSnappingZone = <span class="fl">10.</span>0f;

- (BOOL)continueTracking:(NSPoint)lastPoint at:(NSPoint)currentPoint inView:(NSView *)controlView
{
  CGPoint snapToPoint = currentPoint;

  <span class="kw">for</span> (NSUInteger i = <span class="dv">0</span>; i &lt; <span class="kw">self</span>.numberOfTickMarks; i++)
  {
    NSRect tickMarkRect = [<span class="kw">self</span> rectOfTickMarkAtIndex:i];
    <span class="kw">if</span> (ABS(tickMarkRect.origin.x - currentPoint.x) &lt;= kSnappingZone)
    {
      snapToPoint = [<span class="kw">self</span> rectOfTickMarkAtIndex:i].origin;
      <span class="kw">break</span>;
    }
  }

  <span class="kw">return</span> [<span class="kw">super</span> continueTracking:lastPoint at:snapToPoint inView:controlView];
}

<span class="kw">@end</span></code></pre></td></tr></table>
<p>Enjoy, and <a href="http://www.twitter.com/jonsterling">do let me know</a> if you have a better idea!</p></article>
<h1>Want to comment?</h1>
<p> I’m @jonsterling on <a href="http://www.twitter.com/jonsterling">Twitter</a> and <a href="https://alpha.app.net/jonsterling">App.net</a>.</p>


<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(66625087);
    }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/66625087ns.gif" /></p></noscript>

<a rel="me" href="http://twitter.com/jonsterling"></a>
<a rel="me" href="https://alpha.app.net/jonsterling"></a>
</body>
</html>


<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="readability-verification" content="cG3MqZcEVveKZ6mnEFkePAL3Ug79Jxxp5Fn27CM7" />
<title>JS ⊢ Terms Indexed by Canonicity Admit Coercion Across Isomorphism</title>
<link rel="stylesheet" type="text/css" href="../css/screen.css" />
<link rel="stylesheet" type="text/css" href="../css/syntax.css" />
<link rel="stylesheet" type="text/css" href="../css/coqdoc.css" />
<style type="text/css">
    @import url(http://nmashton.ca/css/gloss-0.0.1.css);
</style>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="http://nmashton.ca/js/gloss-0.0.1.js"></script>
<link rel="alternate" type="application/rss+xml" title="Jonathan Sterling" href="../rss.xml" />


<!--[if IE]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<!--[if lte IE 7]>
  <script src="js/IE8.js" type="text/javascript"></script><![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" type="text/css" media="all" href="css/ie6.css"/><![endif]-->

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  'HTML-CSS': {
    availableFonts: [],
    webFont: 'TeX',
  },
  TeX: {
    Macros: {
      gk: ["\\style{font-family:Junicode!important; font-size:1.3em;}{\\text{#1}}", 1]
    }
  }
});
</script>
</head>
<body>

<header>
<h1><a href="../index.html"><span class="title">Terms Indexed by Canonicity Admit Coercion Across Isomorphism.</span></a></h1>
</header>

<section class="post">
<article><p>Let <span class="math">\(\mathcal{U}\)</span> be an impredicative universe defined as follows with an empty set, a unit set, a boolean set, non-dependent functions, products, and some notion of equality which we will elaborate upon later:</p>
<p><span class="math">\[\begin{align*}
\mathcal{U} &amp;:\equiv \{`\text{Set}, `\mathbf{0}, `\mathbf{1}, `\mathbf{2},
\cdot`\to\cdot, \cdot`\otimes\cdot, \cdot`\cong\cdot \}
\end{align*}\]</span></p>
<p><span class="math">\(\mathcal{U}\)</span> is embedded in Martin-Löf Type Theory with UIP and given with the following translation:</p>
<p><span class="math">\[\begin{align*}
⟦`\text{Set}⟧ &amp;\mapsto \color{blue}{\text{Set}}\\
⟦`\mathbf{0}⟧,  ⟦`\mathbf{1}⟧, ⟦`\mathbf{2}⟧ &amp;\mapsto \color{blue}{\bot}, \color{blue}{\top},
\color{blue}{\text{Bool}}\\
⟦A\, `\to\, B⟧, ⟦A\, `\otimes\, B⟧ &amp;\mapsto \color{blue}{\prod_{x : ⟦A⟧} ⟦B⟧}, \color{blue}{\sum_{x : ⟦A⟧} ⟦B⟧}\\
⟦A\, `\cong\, B⟧ &amp;\mapsto \color{blue}{⟦A⟧ \equiv ⟦B⟧}\\
\end{align*}\]</span></p>
<p>We define <span class="math">\(\mathcal{U}\)</span> together with a term language, and in a particularly egregious abuse of notation, conflate the interpreting functions <span class="math">\(⟦\cdot⟧\)</span> for the two.</p>
<!--more-->

<p>In addition to indexing terms by their type in <span class="math">\(\mathcal{U}\)</span>, let us in addition index them by their canonicity, or, more precisely, their ability to be reduced to a canonical term in the metalanguage. We will color canonical terms in <span class="math">\(\mathbf{black}\)</span>, and non-canonical terms in <span class="math">\(\mathbf{\color{red}{red}}\)</span>. As above, terms in the metalanguage will be given in <span class="math">\(\mathbf{\color{blue}{blue}}\)</span>. The term embeddings are given as follows:</p>
<p><span class="math">\[\begin{align}
\frac{\vdash x : `\mathbf{0}}{\vdash `!\, x : A}\tag{Absurd}
\end{align}\]</span></p>
<p><span class="math">\[\begin{align}
\frac{}{\vdash `\diamond : `\mathbf{1}} \tag{$\mathbf{1}$-intro}
\end{align}\]</span></p>
<p><span class="math">\[\begin{align}
\frac{}{\vdash `1, `2 : `\mathbf{2}} \tag{$\mathbf{2}$-intro}
\end{align}\]</span></p>
<p><span class="math">\[\begin{align}
\frac{\vdash x : \mathbf{2} \qquad \vdash t, f : A}{\vdash `\text{if}\ x\ \text{then}\ t\ \text{else}\ f : A} \tag{$\mathbf{2}$-rec}
\end{align}\]</span></p>
<p><span class="math">\[\begin{align}
\frac{\vdash f : A \qquad \vdash x : A}{\vdash f\ x :
B}\tag{App}
\end{align}\]</span></p>
<p>We simply embed functions from the metalanguage here:</p>
<p><span class="math">\[\begin{align}
\frac{\vdash \color{blue}{e : \prod_{a:A}B}}{\vdash
`\lambda\color{blue}{e} : A\,`\to\,B}\tag{Lam}
\end{align}\]</span></p>
<p><span class="math">\[\begin{align}
\frac{\vdash x : A \qquad \vdash y : B}{\vdash x\,`,\,y :
A\,`\otimes\,B}\tag{Pair}
\end{align}\]</span></p>
<p><span class="math">\[\begin{align}
\frac{\vdash p : A\,`\otimes\,B}{\vdash `\pi_1\ p : A \qquad \vdash
`\pi_2\ p : B}\tag{Proj}
\end{align}\]</span></p>
<p>Because the metalanguage we have chosen respects the Unicity of Identity Proofs, we can have a more flexible embedding of reflexivity in our object language, leaving the evidence to the metalanguage:</p>
<p><span class="math">\[\begin{align}
\frac{\vdash x, y : A \qquad \vdash \color{blue}{p : ⟦x⟧ \equiv  ⟦y⟧}}{\vdash `\text{refl}_A\ x\ y\ \color{blue}{p} : x\,`\cong_A\,y}\tag{Refl}
\end{align}\]</span></p>
<p>And now for the fun part: we use the full force of the metalanguage to prove a coherent isomorphism between two object language types, and then we simply assert that it is an identity, with the caveat that it is not canonical.</p>
<p><span class="math">\[\begin{align}
\frac{\vdash \color{blue}{f : \prod_{x:⟦A⟧}⟦B⟧} \quad \vdash
\color{blue}{g : \prod_{x:⟦B⟧}⟦A⟧} \quad \vdash \color{blue}{\alpha :
\prod_{x:⟦B⟧} f\ (g\ x)\, \equiv \, x}\quad \vdash \color{blue}{\beta :
\prod_{x:⟦A⟧} g\ (f\ x)\, \equiv \, x}}{\vdash \color{red}{`\text{iso}_{A,B}\ \color{blue}{f\ g\ \alpha\ \beta} : A\,`\cong_{`\text{Set}} B}}\tag{Iso}
\end{align}\]</span></p>
<p>Note that so far, none of our typing rules have admitted non-canonical premises, with the result that such a construction cannot escape the object language! We now provide a rule to eliminate equivalences within the object language in a safe way, which we will show to be interpretable into canonical terms of the metalanguage:</p>
<p><span class="math">\[\begin{align}
\frac{\vdash \color{red}{p : A\,`\cong B} \qquad \vdash x : A}{\vdash\text{transport}\ \color{red}{p}\ x : B} \tag{Transport}
\end{align}\]</span></p>
<p>Now this is not as powerful as <span class="math">\(\text{transport}\)</span> in typical type theories, in that it doesn’t admit mapping over a fibration <span class="math">\(P : A\,`\to\,`\text{Set}\)</span> to get a term in <span class="math">\(P\ B\)</span>; it may be possible to make that work, but I am afraid it is beyond my skill-level on this very day.</p>
<p>By trapping the axiom that isomorphism implies equality between two rules <span class="math">\(\text{Iso}\)</span> and <span class="math">\(\text{Transport}\)</span> and indexing our terms by a notion of canonicity, we have made it possible to ensure that isomorphisms are translated out of any terms that may be constructed and passed to the interpreter. Let us define the interpreter, and then do the typical demonstrations for such a thing:</p>
<p><span class="math">\[\begin{align*}
⟦`!\,x⟧ &amp;\mapsto \color{blue}{!\,⟦x⟧}\\
⟦`\diamond⟧ &amp;\mapsto \color{blue}{\text{tt}}\\
⟦`1⟧, ⟦`2⟧ &amp;\mapsto \color{blue}{\text{true}}, \color{blue}{\text{false}}\\
⟦`\text{if}\ x\ \text{then}\ t\ \text{else}\ f⟧ &amp;\mapsto \color{blue}{\text{if}\ ⟦x⟧\ \text{then}\ ⟦t⟧\ \text{else}\ ⟦f⟧}\\
⟦f\ x⟧ &amp;\mapsto \color{blue}{⟦f⟧\ x}\\
⟦`\lambda\,\color{blue}{e}⟧ &amp;\mapsto \color{blue}{\lambda\,x. ⟦e\ x⟧}\\
⟦x\,`,\,y⟧ &amp;\mapsto \color{blue}{⟦x⟧\,,\,⟦y⟧}\\
⟦`\pi_1\ p⟧, ⟦`\pi_2\ p⟧ &amp;\mapsto \color{blue}{\pi_1\ ⟦p⟧}, \color{blue}{\pi_2\ ⟦p⟧}\\\
⟦`\text{refl}_A\ x\ y\ \color{blue}{p}⟧ &amp;\mapsto \color{blue}{p}\\
⟦`\text{transport}\ \color{red}{(`\text{iso}_{A,B}\ \color{blue}{f\ g\ \alpha\ \beta})}\ x⟧ &amp;\mapsto \color{blue}{f\ ⟦x⟧}
\end{align*}\]</span></p>
<p>Now, we can see how these isomorphisms work out in practice. Let’s demonstrate that the identity and swapping functions for pairs are in fact equivalences:</p>
<p><span class="math">\[\begin{align*}
\color{blue}{\text{id}} &amp;\mapsto\color{blue}{\lambda x.\
x}\\
\color{blue}{\text{swap}} &amp;\mapsto \color{blue}{\lambda \{x\,,\,y\}.\ y\,,\,x}\\
\color{red}{\text{id-equiv}_{A`\otimes B}} &amp;\mapsto \color{red}{`\text{iso}_{A`\otimes B,A`\otimes B}\ \color{blue}{\text{id}\ \text{id}\ (\lambda\,\_.\ \text{refl})\  (\lambda\,\_.\ \text{refl})}}\\
\color{red}{\text{swap-equiv}_{A`\otimes B}} &amp;\mapsto \color{red}{`\text{iso}_{A`\otimes B,B`\otimes A}\ \color{blue}{\text{swap}\ \text{swap}\ (\lambda\,\_.\ \text{refl})\  (\lambda\,\_.\ \text{refl})}}
\end{align*}\]</span></p>
<p>Then, we should like to of course prove the correct computational behavior of <span class="math">\(\text{transport}\)</span>:</p>
<p><span class="math">\[\begin{align}
\text{id-equiv-sound} &amp;: (`\text{transport}\
\color{red}{\text{id-equiv}_{`\mathbf{2}`\otimes`\mathbf{1}}}\
(`1\,,\,`\diamond))\, `\cong_{`\mathbf{2}`\otimes`\mathbf{1}} (`1\,,\,`\diamond)\\
&amp;\mapsto `\text{refl}\ \_\ \_\ \color{blue}{\text{refl}}
\end{align}\]</span></p>
<p>And when we transport over the swapping isomorphism, we get the expected results to hold definitionally:</p>
<p><span class="math">\[\begin{align}
\text{swap-equiv-sound} &amp;: (`\text{transport}\
\color{red}{\text{swap-equiv}_{`\mathbf{2}`\otimes`\mathbf{1}}}\
(`1\,,\,`\diamond))\, `\cong_{`\mathbf{2}`\otimes`\mathbf{1}} (`\diamond\,,\,`1)\\
&amp;\mapsto `\text{refl}\ \_\ \_\ \color{blue}{\text{refl}}
\end{align}\]</span></p>
<p>And of course, in the spirit of recent developments in Type Theory, this construction is formalized in Agda<sup><a href="#fn1" class="footnoteRef" id="fnref1">1</a></sup> on <a href="https://gist.github.com/jonsterling/5898241">GitHub</a> should you wish to fiddle with it.</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Well, easy-mode Agda that is, with all the improper options turned on.<a href="#fnref1">↩</a></p></li>
</ol>
</div></article>
<h1>Want to comment?</h1>
<p> I’m @jonsterling on <a href="http://www.twitter.com/jonsterling">Twitter</a> and <a href="https://alpha.app.net/jonsterling">App.net</a>.</p>


<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(66625087);
    }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/66625087ns.gif" /></p></noscript>

<a rel="me" href="http://twitter.com/jonsterling"></a>
<a rel="me" href="https://alpha.app.net/jonsterling"></a>
</body>
</html>

